<h3>Jobs by Student</h3>

<table class="table">
  <thead>
    <tr>
      <th>ID</th>
      <th>First Name</th>
      <th>Last Name</th>
      <th>CWL</th>
      <th>E-mail</th>
      <th>Jobs</th>
    </tr>
  </thead>
  <tbody>
    {% for student in students %}
      <tr>
        <td>{{ student.id }}</td>
        <td>{{ student.first_name }}</td>
        <td>{{ student.last_name }}</td>
        <td>{{ student.username }}</td>
        <td>{{ student.email }}</td>
        <td>
          <button type="button" class="btn btn-sm" data-toggle="modal" data-target="#student-modal-{{ student.id }}">
            {{ student.application_set.count }}
          </button>
          <div class="modal fade" id="student-modal-{{ student.id }}" tabindex="-1" role="dialog" aria-labelledby="student-modal-label-{{ student.id }}" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="student-modal-label-{{ student.id }}">Student Jobs</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                  <table>
                    <thead>
                      <tr>
                        <th>Year</th>
                        <th>Term</th>
                        <th>Job</th>
                        <th>Assigned TA Hours</th>
                        <th>Applicant TA Hours</th>
                        <th>Status</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for app in student.application_set.all %}
                        <tr>
                          <td>{{ app.job.session.year }}</td>
                          <td>{{ app.job.session.term.code }}</td>
                          <td>{{ app.job.course.code.name }} {{ app.job.course.number.name }} {{ app.job.course.section.name }}</td>
                          <td>{{ app.job.assigned_ta_hours }} hours</td>
                          <td>{{ app.job.ta_hours }} hours</td>
                          <td>
                            <ul>
                              {% for st in app.status.all %}
                                <li>{{ st.get_assigned_display }}: {{ st.assigned_hours }} hours ({{ st.created_at }} | {{ st.updated_at }})</li>
                              {% empty %}
                                <li>No status found</li>
                              {% endfor %}
                            </ul>
                          </td>
                        </tr>
                      {% empty %}
                        <tr>
                          <td colspan="6">No jobs found</td>
                        </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </td>
      </tr>

    {% empty %}
      <tr>
        <td colspan="5">No students found</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
