{% extends 'ta_app/base.html' %}
{% block content %}

{% include 'administrators/util/_sidebar.html' %}

<div id="content" class="container-fluid">
  {% include 'ta_app/_return_messages.html' with data=messages %}

  <h3>Offered Applications</h3>

  {% if offered_applications|length > 0 %}
    <form action="{% url 'administrators:offered_applications_send_email' %}" method="post">
      {% csrf_token %}
      <table class="table table-sm table-bordered table-hover table-striped table-responsive-md text-center" data-toggle="table" data-sortable="true" data-classes="" data-pagination="true" data-search="true">
        <thead>
          <tr>
            <th data-sortable="true">ID</th>
            <th data-sortable="true">Year</th>
            <th data-sortable="true">Term</th>
            <th data-sortable="true">Job</th>
            <th data-sortable="true">Applicant</th>
            <th data-sortable="true">Status</th>
            <th data-sortable="true">Instructor Preference</th>
            <th data-sortable="true">Classification</th>
            <th data-sortable="true">Note</th>
            <th data-sortable="true">Created at</th>
            <th data-sortable="true">Updated at</th>
            <th>Select to email</th>
          </tr>
        </thead>
        <tbody>
          {% for app in offered_applications %}
            <tr>
              <td>
                <a href="{% url 'show_application' app_slug=app.slug path='offered' portal='Admin' %}">{{ app.id }}</a>
              </td>
              <td>{{ app.job.session.year }}</td>
              <td>{{ app.job.session.term.code }}</td>
              <td>
                <a href="{% url 'show_job' session_slug=app.job.session.slug job_slug=app.job.course.slug path='offered' portal='Admin' %}">
                  {{ app.job.course.code.name }} {{ app.job.course.number.name }} {{ app.job.course.section.name }}
                </a>
              </td>
              <td>
                <a href="{% url 'show_user' username=app.applicant.username path='student' portal='Admin' %}">{{ app.applicant.first_name }} {{ app.applicant.last_name }}</a>
              </td>
              <td>
                {{ app.applicationstatus_set.all.last.get_assigned_display }}
                {% include 'administrators/util/_modal_application_status.html' with data=app %}
              </td>
              <td>{{ app.get_instructor_preference_display }}</td>
              <td>{{ app.classification.year }} {{ app.classification.name }}</td>
              <td>{{ app.note }}</td>
              <td>{{ app.created_at }}</td>
              <td>{{ app.updated_at }}</td>
              <td>
                {% if app.email_set.all|length > 0 %}
                  {{ app.email_set.all|length }}
                {% else %}
                  <input type="checkbox" name="application" value="{{ app.id }}" />
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

      <div>
        <h5>Select Email Type:</h5>
        <label class="radio-inline"><input type="radio" name="email_type" value="type1" checked />Type 1</label>
        <label class="radio-inline"><input type="radio" name="email_type" value="type2" />Type 2</label>
      </div>

      <input class="btn btn-lg btn-primary" type="submit" value="Send Email" />
    </form>

  {% else %}
    No applications found
  {% endif %}


</div>

{% endblock %}
