{% extends 'ta_app/base.html' %}
{% block content %}

{% include 'administrators/_menu.html' %}
<div>
  {% include 'ta_app/pages/_header.html' with title='Destroy User Contents' text=users|length %}

  <div class="bd-callout bd-callout-warning col-8 mx-auto">
    <h4>Notice</h4>
    <p>
      Users who logged in before the date (<span class="font-weight-bold text-danger">{{ target_date }}</span>) are in the table below.
      If you would like to destroy permanently all of their contents such as profile, resume and confidential information, please click on the Destroy button below.
    </p>
  </div>

  <form action="" method="post" onsubmit="return confirm('Are you sure to remove the information of those users?')">
    {% csrf_token %}

    <table
      class="table table-bordered table-hover table-striped table-responsive-md text-center"
      data-toggle="table"
      data-sortable="true"
      data-classes=""
      data-pagination="true"
      data-search="true"
      data-page-size="50"
      data-page-list="[50, 100, 200, all]"
      data-show-export="true"
      data-show-columns="true"
      data-export-types="['csv']"
    >
      <thead>
        <tr>
          <th>Select</th>
          <th data-sortable="true">User ID</th>
          <th data-sortable="true">Full Name</th>
          <th data-sortable="true">CWL</th>
          <th data-sortable="true">Student<br /> Number</th>
          <th data-sortable="true">Role</th>
          <th data-sortable="true">Date Joined</th>
          <th data-sortable="true">Last Login</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
          <tr>
            <td>
              <input type="checkbox" name="user" value="{{ user.id }}" checked />
            </td>
            <td>{{ user.id }}</td>
            <td>{{ user.get_full_name }}</td>
            <td>
              <a href="{% url 'administrators:show_user' username=user.username path='destroy' tab='basic' %}">{{ user.username }}</a>
            </td>
            <td>{{ user.profile.student_number }}</td>
            <td>
              {% for role in user.profile.roles.all %}
                {% include 'ta_app/users/_role.html' with data=role.name %}
              {% endfor %}
            </td>
            <td>{{ user.date_joined }}</td>
            <td>{{ user.last_login }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <input class="btn btn btn-danger mt-3" type="submit" value="Destroy profile, resume and confidential information" />

  </form>

</div>

{% endblock %}
