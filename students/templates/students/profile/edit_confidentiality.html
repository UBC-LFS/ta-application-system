{% extends 'ta_app/base.html' %}
{% block content %}

{% include 'students/_menu.html' %}
<div class="row">
  <div class="col-md-4">
    {% include 'ta_app/pages/_left_aside.html' with view_name='users'   title='Edit Confidential Info.' data=loggedin_user %}

    <div class="left-aside-btn-groups">
      <a class="btn btn-outline-primary" href="{% url 'students:show_confidentiality' %}">Back to Confidential Info.</a>
    </div>
  </div>

  <div class="col-md-8">

    <div class="board col-11 mx-auto">
      <h3>Confidential Infomation Edit Form</h3>

      <div class="bd-callout bd-callout-warning bg-light-gray">
        <h4>
          <i class="fa fa-bullhorn" aria-hidden="true"></i> Notice
        </h4>
        <p>
          <i class="fa fa-check" aria-hidden="true"></i>
          If you would like to change your SIN or Study Permit, please delete your old information first, and then update your new one.
        </p>
        {% include 'ta_app/pages/_nationality_message.html' %}
      </div>

      {% include 'ta_app/pages/_upload_message.html' %}

      <form action="" method="post" enctype="multipart/form-data">
        {% csrf_token %}

        {% for field in form.visible_fields  %}
          <div class="field-wrapper">
            {{ field.label_tag }}
            {% if field.help_text %}
              <div class="help">{{ field.help_text|safe }}</div>
            {% endif %}
            {{ field }}
          </div>
        {% endfor %}

        {% for field in form.hidden_fields %}
          {{ field }}
        {% endfor %}

        <a class="btn btn-outline-secondary" href="{% url 'students:show_confidentiality' %}">Cancel</a>
        <input class="btn btn-primary" type="submit" value="Update" />
      </form>

      <div class="card border-danger">
        <div class="card-body">
          <div>
            {% if loggedin_user.confidentiality.sin %}
              <span>File: {{ sin_file }}</span>

              <form action="{% url 'students:delete_sin' %}" method="post" onsubmit="return confirm('Are you sure to delete this SIN file?')">
                {% csrf_token %}

                {% if loggedin_user.confidentiality.nationality == '1' %}
                  <div>
                    <small class="text-muted">Please check the box below to to delete your SIN Expiry Date.</small><br />
                    <input type="checkbox" name="delete_sin_expiry_date" value="1" />
                    Delete SIN Expiry Date
                  </div>
                {% endif %}

                <input type="hidden" name="user" value="{{ loggedin_user.username }}" />
                <input class="btn btn-danger mt-3" type="submit" value="Delete SIN" />
              </form>
            {% else %}
              <div class="text-secondary">No SIN found</div>
            {% endif %}
          </div>

          <div>
            {% if loggedin_user.confidentiality.nationality == '1' %}

              {% if loggedin_user.confidentiality.study_permit %}
                <span>File: {{ study_permit_file }}</span>

                <form action="{% url 'students:delete_study_permit' %}" method="post" onsubmit="return confirm('Are you sure to delete this Study Permit file?')">
                  {% csrf_token %}

                  <div>
                    <small class="text-muted">Please check the box below to to delete your Study Permit Expiry Date.</small><br />
                    <input type="checkbox" name="delete_study_permit_expiry_date" value="1" />
                    Delete Study Permit Expiry Date
                  </div>

                  <input type="hidden" name="user" value="{{ loggedin_user.username }}" />
                  <input class="btn btn-danger" type="submit" value="Delete Study Permit" />
                </form>
              {% else %}
                <div class="text-secondary">No Study Permit found</div>
              {% endif %}

            {% endif %}
          </div>

          <div>
            {% if loggedin_user.confidentiality.personal_data_form %}
              <span>File: {{ personal_data_form_file }}</span>

              <form action="{% url 'students:delete_personal_data_form' %}" method="post" onsubmit="return confirm('Are you sure to delete this Personal Data Form file?')">
                {% csrf_token %}

                <input type="hidden" name="user" value="{{ loggedin_user.username }}" />
                <input class="btn btn-danger btn-xs" type="submit" value="Delete Personal Data Form" />
              </form>
            {% else %}
              <div class="text-secondary">No Personal Data Form found</div>
            {% endif %}
          </div>
          
        </div>
      </div>

    </div>

  </div>
</div>

{% endblock %}
