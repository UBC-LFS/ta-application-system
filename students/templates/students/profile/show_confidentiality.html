{% extends 'ta_app/base.html' %}
{% block content %}
{% load static %}
{% include "students/util/_sidebar.html" %}

<div id="content" class="container-fluid">
  {% include 'ta_app/_return_messages.html' with data=messages %}

  <div class="mb-3">
    <img class="ubc-logo d-inline-block" src="{% static 'ta_app/images/UBClogo.jpeg' %}" alt="ubc logo" />
    <div class="d-inline-block ml-3">
      <h3 class="mb-3">Confidentiality</h3>
    </div>
  </div>

  {% if user.confidentiality and user.confidentiality.created_at != None %}

    <section>
      <div class="mb-4">
        <h5>Employee Number:</h5>
        {{ user.confidentiality.employee_number }}
      </div>

      <div class="mb-4">
        <h5>Social Insurance Number (SIN):</h5>

        {% if user.sin_data %}
          <img src="{{ user.sin_data.url }}" width="150" height="120" alt="SIN-image" /><br />
          <a href="{{ user.sin_data.url }}" download="{{ user.sin_data.filename }}">{{ user.sin_data.filename }}</a>

          <form action="{% url 'students:delete_sin' %}" method="post" onsubmit="return confirm('Are you sure to delete this SIN file?')">
            {% csrf_token %}
            <input type="hidden" name="user" value="{{ loggedin_user.username }}" />
            <input class="btn btn-sm btn-danger" type="submit" value="Delete" />
          </form>
        {% else %}
          None
        {% endif %}
      </div>

    </section>

    {% if user.confidentiality.is_international %}

      <section class="mb-5">
        <div class="mb-4">
          <h5>SIN Expiry Date:</h5>
          {{ loggedin_user.confidentiality.sin_expiry_date }}
        </div>

        <div class="mb-4">
          <h5>Study Permit:</h5>

          {% if user.study_permit_data %}
            <img src="{{ user.study_permit_data.url }}" width="150" height="120" alt="Study-Permit-image" /><br />
            <a href="{{ user.study_permit_data.url }}" download="{{ user.study_permit_data.filename }}">{{ user.study_permit_data.filename }}</a>

            <form action="{% url 'students:delete_study_permit' %}" method="post" onsubmit="return confirm('Are you sure to delete this Study Permit file?')">
              {% csrf_token %}
              <input type="hidden" name="user" value="{{ loggedin_user.username }}" />
              <input class="btn btn-sm btn-danger" type="submit" value="Delete" />
            </form>
          {% else %}
            None
          {% endif %}
        </div>
        <div>
          <h5>Study Permit Expiry Date:</h5>
          {{ user.confidentiality.study_permit_expiry_date }}
        </div>

      </section>

    {% endif %}

    <a class="btn btn-warning" href="{% url 'students:edit_confidentiality' %}">Edit Confidentiality</a>

  {% else %}

    <section class="text-secondary">
      <div>
        <p>If you are an international student, please click down below.</p>
        <form action="{% url 'students:check_confidentiality' %}" method="post">
          {% csrf_token %}
          <input type="hidden" name="user" value="{{ user.id }}" />
          <input type="hidden" name="is_international" value="True" />
          <input class="btn btn-lg btn-primary" type="submit" value="I am an International student" />
        </form>
      </div>
      <div class="my-5">OR</div>
      <div>
        <p>If you are a Canadian citizen or Permanent Resident, please click down below.</p>
        <form action="{% url 'students:check_confidentiality' %}" method="post">
          {% csrf_token %}
          <input type="hidden" name="user" value="{{ user.id }}" />
          <input type="hidden" name="is_international" value="False" />
          <input class="btn btn-lg btn-primary" type="submit" value="I am a Canadian citizen/Permanent Resident" />
        </form>
      </div>
    </section>


  {% endif %}
</div>

{% endblock %}
