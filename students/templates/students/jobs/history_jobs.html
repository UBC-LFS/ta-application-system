{% extends 'ta_app/base.html' %}
{% block content %}

{% include 'students/_menu.html' %}
<div>
  {% include 'ta_app/pages/_header.html' with title='History of Jobs' text=apps|length %}

  <div class="bg-prompt">
    <div class="prompt p-4 text-center mb-4">
      <h4>Status: Get a glance</h4>
      <p class="col-8 mx-auto">Please check status of your submitted applications carefully.</p>
      <a class="btn btn-outline-primary" href="{% url 'students:explore_jobs' %}">Back to Explore Jobs</a>
    </div>
  </div>

  {% include 'students/jobs/_search_fields.html' with data=apps total=total_apps path='history_jobs' %}
  <table
    class="table table-bordered table-hover table-striped table-responsive-md text-center font-size-1"
    data-toggle="table"
    data-sortable="true"
    data-classes=""
  >
    <thead>
      <tr>
        <th data-sortable="true">Year</th>
        <th data-sortable="true">Term</th>
        <th data-sortable="true">Job</th>
        <th data-sortable="true">Application</th>
        <th data-sortable="true">Applied at</th>
        <th data-sortable="true">Status</th>
      </tr>
    </thead>
    <tbody>
      {% for app in apps %}
        <tr>
          <td>{{ app.job.session.year }}</td>
          <td>{{ app.job.session.term.code }}</td>
          <td>
            <a href="{% url 'students:show_job' session_slug=app.job.session.slug job_slug=app.job.course.slug %}">
              {{ app.job.course.code.name }} {{ app.job.course.number.name }} {{ app.job.course.section.name }}
            </a>
          </td>
          <td>
            <a href="{% url 'students:show_application' app_slug=app.slug %}">View</a>
          </td>
          <td>{{ app.applied.created_at }}</td>
          <td>
            {% if app.offered %}

              {% include 'ta_app/applications/_app_status.html' with data=app.offered.get_assigned_display %}<br />
              <small class="text-muted">{{ app.offered.created_at }}</small>
              <div>
                <span class="font-weight-bold">{{ app.offered.assigned_hours }}</span> hours
              </div>

              <hr />
              <a href="{% url 'students:accept_decline_job' session_slug=app.job.session.slug job_slug=app.job.course.slug %}">Accept / Decline</a>

            {% elif app.accepted %}

              {% include 'ta_app/applications/_app_status.html' with data=app.accepted.get_assigned_display %}<br />
              <small class="text-muted">{{ app.accepted.created_at }}</small>
              <div>
                <span class="font-weight-bold">{{ app.accepted.assigned_hours }}</span> hours
              </div>

              {% if app.is_terminated %}
                <hr />
                <a href="{% url 'students:cancel_job' session_slug=app.job.session.slug job_slug=app.job.course.slug %}">Cancel</a>
              {% endif %}

            {% elif app.declined %}

              {% include 'ta_app/applications/_app_status.html' with data=app.declined.get_assigned_display %}<br />
              <small class="text-muted">{{ app.declined.created_at }}</small>

            {% elif app.cancelled %}

              {% include 'ta_app/applications/_app_status.html' with data=app.cancelled.get_assigned_display %}<br />
              <small class="text-muted">{{ app.cancelled.created_at }}</small>

            {% else %}

              {% include 'ta_app/applications/_app_status.html' with data='None' %}

            {% endif %}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  {% include 'ta_app/pages/_table_paginator.html' with data=apps %}

</div>

{% endblock %}
